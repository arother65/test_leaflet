<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- ejs CSS classes ? -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> -->

    <!-- using CDN "unpkg"; https://leafletjs.com/download.html -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- use "defer" attribute? -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="">
        </script>

    <!-- -->
    <!-- <link href="styles.css" rel="stylesheet" crossorigin="anonymous"> -->
    <link href="styles.css" type="text/css" rel="stylesheet" crossorigin="">

    <link rel="icon" type="image/x-icon" href="../public/img/favicon.ico">

    <title>index.html leaflet</title>
</head>

<!-- body -->

<!-- <body class="body"> -->

<body onpageshow="onPageShow()" onload="onLoad()">

    <!-- header -->
    <header>
        <h4 class="header">Tests Leaflet and geopositioning</h4>
    </header>

    <!-- erste Reihe mit zwei spalten -->
    <!-- https://www.w3schools.com/css/css_grid.asp ; CSS grid layout -->
    <div class="grid-container">
        <div class="grid-item">item1
            <label for="idInLat">Latitude: </label>
            <input type="text" class="" id="idInLat" value="50.123456">

            <label for="idInLong">Longitude: </label>
            <input type="text" class="" id="idInLong" value="0.123456">

            <button type="button" class="btn" id="idBtnInFields" onclick="onClick(this)">use data from inFields</button>

            <div class="grid-container-inner">
                <div class="grid-item">
                    <div>
                        <label for="idRangeLat">Latitude:</label><br />
                        <input type="range" id="idRangeLat" min="30" max="100" steps="1" value="50"
                            onchange="onRangeChange(this)" list="idTickmarks">
                        <datalist id="idTickmarks">
                            <option value="30" label="30"></option>
                            <option value="40" label="40"></option>
                            <option value="50" label="50"></option>
                            <option value="60" label="60"></option>
                            <option value="70" label="70"></option>
                            <option value="80" label="80"></option>
                            <option value="90" label="90"></option>
                            <option value="100" label="100"></option>
                        </datalist>
                    </div>
                    <div>
                        <input type="text" id="idTextLat" value="50" disabled>
                    </div>
                </div>
            </div> <!-- grid-container-inner -->

            <div class="grid-container-inner">
                <div class="grid-item">
                    <div>
                        <label for="idRangeLat">Longitude:</label><br />
                        <input type="range" id="idRangeLong" min="0" max="50" steps="1" value="0"
                            onchange="onRangeChange(this)" list="idTickmarks02">
                        <datalist id="idTickmarks02">
                            <option value="0" label="0"></option>
                            <option value="10" label="10"></option>
                            <option value="20" label="20"></option>
                            <option value="30" label="30"></option>
                            <option value="40" label="40"></option>
                            <option value="50" label="50"></option>
                        </datalist>
                    </div>
                    <div>
                        <input type="text" id="idTextLong" value="0" disabled>
                    </div>
                </div>
            </div> <!-- grid-container-inner -->

            <button type="button" class="btn" id="idBtnRanges" onclick="onClick(this)">use data from ranges</button>

        </div> <!-- grid-item 1-->

        <div class="grid-item">item2
            <!-- content -->
            <div class="map" id="idMap01">col: div for map</div>
        </div> <!-- grid-item 2-->
    </div> <!-- grid-container -->

    <!-- zweite Reihe mit zwei spalten -->
    <div class="grid-container">
        <div class="grid-item">
            <text>Text02 HTML-tag</text>
        </div>
        <div class="grid-item">2
            <!-- content -->
            <div class="map" id="idMap02">col: div for map</div>
        </div>
    </div> <!-- grid-container -->

    <!-- footer -->
    <footer class="footer">
        <div class="grid-container-footer">
            <div class="grid-item-footer">
                <a class="hrefs" href="https://www.sap.com">visit SAP</a>
                <a class="hrefs" href="https://leafletjs.com/">visit leaflet</a>
                <a class="hrefs" href="https://www.openstreetmap.org/">visit openstreetmap</a>
            </div>
            <div class="grid-item-footer">
            </div>
            <div class="grid-item-footer">
                <div>&copy; anro@email.de</div>
            </div>
        </div>
    </footer>

    <!-- scripting -->
    <script>

        //
        var oMap01, oMap02, gcEventType;

        // 
        async function getCurrentPosition() {

            // navigator.geolocation.getCurrentPosition(<fkt success>, <fkt error>);
            navigator.geolocation.getCurrentPosition(
                function (success) {

                    console.log('success.coords:')  // typeof GeolocationPosition
                    console.log('latitude: ', success.coords.latitude, 'longitude: ', success.coords.longitude)  //

                    //* initialize oMap01 
                    //                                Breite, Länge
                    // var oMap = L.map('idMap').setView([51.505, -0.09], 13);
                    oMap01 = L.map('idMap01').setView([success.coords.latitude, success.coords.longitude], 10);

                    // get a tile layer to add it to variable "oMap"
                    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                    }).addTo(oMap01);

                    // oMap.on() = eventLIstener for the allocated oMap-Object

                    // display a "marker" L.<method()>

                    //* display second map oMap02
                    const cLatitude = success.coords.latitude - 5.0;  // weiter in den Süden
                    const cLongitude = success.coords.longitude + 5.0;  // weiter in den Osten 
                    console.log('cLatitude: ', cLatitude, 'cLongitude: ', cLongitude);
                    oMap02 = L.map('idMap02').setView([cLatitude, cLongitude], 10);

                    // get a tile layer to add it to variable "oMap"
                    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                    }).addTo(oMap02);
                },
                function (error) {
                    // console.log(error)

                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            console.log("User denied the request for Geolocation.")
                            break;
                        case error.POSITION_UNAVAILABLE:
                            console.log("Location information is unavailable.")
                            break;
                        case error.TIMEOUT:
                            console.log("The request to get user location timed out.")
                            break;
                        case error.UNKNOWN_ERROR:
                            console.log("An unknown error occurred.")
                            break;
                    }  // switch()
                }
            )  // navigator.geolocation.getCurrentPosition()
        }  // getCurrentPosition()

        // 
        async function showMap(ivLatitude, ivLongitude) {

            // showing map with coords from input params:
            console.log('ivLatitude: ', ivLatitude, 'ivLongitude: ', ivLongitude);

            if (!oMap01) {
                // factory L.map(DOM ID of a <div> element)
                // oMap01 = L.map('idMap01').setView([ivLatitude, ivLongitude], 10);  //? prototype e 

                oMap01 = L.map('idMap01');
                oMap01.setView([ivLatitude, ivLongitude], 8);  //? prototype e 

                // get a tile layer to add it to variable "oMap01"
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }).addTo(oMap01);

            } else {
                // one layer was already allocated
                // L.removeLayer(<Layer> layer); // returns this
                oMap01.removeLayer(this);  //?

                //? neue layer mit veränderten Koordinaten
                oMap01.setView([ivLatitude, ivLongitude], 8);
            }
        } // showMap()

        // Global Event Attributes
        // https://www.w3schools.com/tags/ref_eventattributes.asp
        // 
        async function onClick(gvThis) {

            // alert('gcEventType: ' + gcEventType);

            let lvLat = '';
            let lvLong = '';

            let lvLatNumc = 0;
            let lvLongNumc = 0;

            switch (gvThis.id) {
                case 'idBtnInFields':
                    // alert('idBtnInFields');

                    // Werte von der UI holen
                    lvLat = document.getElementById('idInLat');
                    lvLong = document.getElementById('idInLong');

                    lvLatNumc = Number(lvLat.value);
                    lvLongNumc = Number(lvLong.value);

                    // console.log('onClick(): ', lvLatNumc, lvLongNumc);
                    break;

                case 'idBtnRanges':
                    // alert('idBtnRanges');

                    // Werte von der UI holen
                    lvLat = document.getElementById('idRangeLat');
                    lvLong = document.getElementById('idRangeLong');

                    lvLatNumc = Number(lvLat.value);
                    lvLongNumc = Number(lvLong.value);
                    break;
            }

            // Karte(n) anzeigen
            await showMap(lvLatNumc, lvLongNumc);

            // gcEventType = '';

        } // onClick()

        async function onPageShow() {
            // alert('onPageShow(): ' + event.type);

            // hier verfügbar: event; event.type; event.srcElement
        }  // onPageShow(): Promise<void> (typecastet auf void)

        async function onLoad() {
            // alert('EventType: ' + event.type);

            // gcEventType = event.type;

            // event.type ( hier 'load'); event.srcElement: document; event.target: document; class Event

        }  // onLoad: Promise<void>

        async function onRangeChange(gvThis) {

            // alert(document.getElementById(gvThis.id).value);

            // idRangeLat, idRangeLong
            let lvActText = '';
            let lvNewValue = '';

            switch (gvThis.id) {
                case 'idRangeLat':
                    lvNewValue = document.getElementById('idRangeLat').value;
                    lvActText = document.getElementById('idTextLat');
                    break;
                case 'idRangeLong':
                    lvNewValue = document.getElementById('idRangeLong').value;
                    lvActText = document.getElementById('idTextLong');
                    break;
            }

            //! Wert von input_type:text setzen
            lvActText.value = lvNewValue;
        }  // onRangeChange()

    </script>
</body>

</html>